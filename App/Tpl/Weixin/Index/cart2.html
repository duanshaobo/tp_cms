<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="yes" name="apple-mobile-web-app-capable">
<meta content="black" name="apple-mobile-web-app-status-bar-style">
<meta name="format-detection" content="telephone=no">
<title>确认订单-{tp#$webinfo.web_title}</title>
<link type="text/css" rel="stylesheet" href="__PUBLIC__/css/comman.css" media="all">
<link type="text/css" rel="stylesheet" href="__PUBLIC__/css/jquery_dialog.css" media="all">
<link type="text/css" rel="stylesheet" href="__PUBLIC__/css/style.css" media="all">	
<script> var SITE_URL="http://www.wdkl168.com/";</script>
<script type="text/javascript" src="__PUBLIC__/js/jquery.min.js"></script> 
<script type="text/javascript" src="__PUBLIC__/js/jquery_dialog.js"></script> 
<script type="text/javascript" src="__PUBLIC__/js/common.js"></script> 
<script type="text/javascript" src="__PUBLIC__/js/jquery.json-1.3.js"></script> 
<script type="text/javascript" src="__PUBLIC__/js/goods.js"></script> 
<script type="text/javascript" src="__PUBLIC__/js/user.js"></script> 	
<script type="text/javascript" src="__PUBLIC__/js/jweixin-1.0.0.js"></script> 
<script type="text/javascript" src="__PUBLIC__/js/area.js"></script> 
<script type="text/javascript" src="__PUBLIC__/js/script.js"></script> 
</head>
<body>
<link type="text/css" rel="stylesheet" href="__PUBLIC__/css/css.css" media="all">

<div id="home">
	<div id="header">
		<div class="logo" style="height:28px; padding-top:10px; background:url(__PUBLIC__/images/xy.png) 10px 8px no-repeat"><span onclick=" history.go(-1);">&nbsp;</span></div>
		<div class="shoptitle"><span>确认订单</span></div>
		<!--right-->
        <include file="Public:logoright"/>
        <!--right-->
	</div>
</div>	
<script type="text/javascript">
function ajax_show_menu(){
	$(".showmenu").toggle();
}
</script>
<style type="text/css">
.show_zhuan{display:none;width:100%; height:100%; position:fixed; top:0px; right:0px; z-index:9999999;filter:alpha(opacity=90);-moz-opacity:0.9;opacity:0.9; background:url(__PUBLIC__/images/121.png) right top no-repeat #000;background-size:100% auto;}
.iconinfo {
position: relative;
margin: 20px auto;
width: 200px;
text-align: center;
}
.iconinfo .ico {
display: block;
margin: 20px auto;
width: 48px;
height: 48px;
-webkit-background-size: cover;
background-size: cover;
background-repeat: no-repeat;
}
.ico-success {
background-image: url(__PUBLIC__/images/ico-success.png); float:left;
}
.iconinfo strong {
font-size: 16px;
font-weight: normal;
display: block;
line-height: 22px; float:left; padding-top:20px;
}
.goodslist p{ line-height:23px;}
.btn-buy {
width: 200px;
}
.btn-buy,.ui-btn,.ui-btn {
width: 200px;
padding: 0;
height: 37px;
border: 0;
border-bottom: 2px solid #b91d11;
-webkit-border-radius: 4px;
-moz-border-radius: 4px;
border-radius: 4px;
background-color: #ec4e4f;
-webkit-box-shadow: 0 1px 1px rgba(0,0,0,.15), inset 0 1px rgba(254,101,101,0);
-moz-box-shadow: 0 1px 1px rgba(0,0,0,.15), inset 0 1px rgba(254,101,101,0);
box-shadow: 0 1px 1px rgba(0,0,0,.15), inset 0 1px rgba(254,101,101,0);
background: #ea4748;
line-height: 37px;
text-align: center;
font-size: 15px;
color: #fff;
text-decoration: none;
}
.dddddd{background-color: #1bb627;border-bottom: 2px solid #1bb674;}
.ui-btn {
display: block;
margin: 5px auto 0;
}
.ui-btn-text{ color:#fff}
.line{line-height:40px;width:100%}
.text-input{padding:6px;width:55%;}
select{width:60%;height:30px}
#list{list-style:none;}
#list li{border:0px solid red;background:#FFF;width:100%;margin-bottom:10px}
.fl{float:left}
.fr{float:right}
.clear{clear:both !important}
.border{border:1px solid red;}
.ml10{margin-left:10px;}
.line22{line-height:22px;}
.well{background:#FFF;padding:5px 10px;margin:10px 0;}
.btn-red{background:#DB383E;padding:10px;color:#FFF;cursor:pointer;width:100px;text-align:center;font-size:16px;font-weight:700}
a.label{padding:10px;border:1px solid #CCC;width:50% !important}
.label:visited{color:#FFF}
.active:active,.active:hover{color:#FFF}
.active{background:#DB383E;border:1px solid #900;color:#FFF}
</style>
<div id="main" style="padding:5px; padding-top:0px; min-height:300px;">
	<if condition="empty($list)">
    <div class="nodata" onclick='location.href="{tp#:U('Index/index')}"'>
        <p>购物车中暂时没有商品~</p>
    </div>
    </if>

	<div <if condition="empty($list)">style="display:none"</if> >
	<ul id="list">
    	<volist name="list" id="item">
            <li>
            <img class="fl" onerror="this.src='__PUBLIC__/images/no-img.png'" src="{tp#$item.spic}" style="width:80px;height:80px;">
                <div class="fl ml10">
                    <p class="line22">商品名称:{tp#$item.name}</p>
                    <if condition="!empty($item['norm'])">
                    <p class="line22">商品规格: <font color='red'> {tp#$item['norm']['title']}</font></p>
                    </if>
                    <p class="line22">商品小计：<font color='red'>￥ {tp#$item.goods_price} X {tp#$item.goods_nums}</font></p>
                     <!--<p class="line22">邮费：<font color='red'>￥ {tp#$item.express_price}</font></p>-->
                </div>
                <div class="clear"></div>
            </li>
        </volist>
        
    </ul>    

	<div class="well">
    	<p class='line'>
        <a class="label add-btn">新增收货地址</a>
        <a class="label active sel-btn">选择历史收货地址</a>
        </p>
    </div>
    	
	<div class="well sel-addr">
    	<p class="line">选择收货地址：
        <select name="addr_id">
        <option value=''>-请选择-</option>
        <volist name="addr_list" id="item">
        <option value="{tp#$item.id}">{tp#$item.consignee}-{tp#$item.mobile}-{tp#$item.address}</option>
        </volist>
        </select>
        </p>
    </div>
	<div class="well add-addr" style="display:none">
    	
        <p class="line">
        收货人　：<input name="consignee" class='text-input' placeholder="收货人姓名" value="{tp#$user_info.name}"/>
        </p>
        <p class="line">
        联系电话：<input name="mobile" type="tel" class='text-input number' placeholder="联系电话" maxlength="11" value="{tp#$user_info.mobile}"/>
        </p>
        <p class="line">
        省　　份：<select id="province">
        <option>-请选择-</option>
        </select>
        </p>
        <p class="line">
        城　　市：<select id="city">
        <option>-请选择-</option>
        </select>
        </p>
        <p class="line">
        区　　县：<select id="district" name="district">
        <option>-请选择-</option>
        </select>
        </p>
        <p class="line">
        详细地址：<input name="address" class='text-input' placeholder="详细地址" value="{tp#$user_info.address}"/>
        </p>
        
        
    </div>
    
    <div class="well">
    
    <p class="line">
        支付方式：<select id="pay_way">
        <option value="1">微信支付</option>
        <!--<option value="2">余额支付</option>-->
        </select>
        </p>
       <!-- <p class="line">
        配送方式：<select name="express" id="exp">
                <volist name="express" id="item">
                <option price="{tp#$item.price}" value="{tp#$item.id}">{tp#$item.name}</option>
                </volist>
                </select>
        </p>  -->
        <p class="line" style="color:#DB383E;font-weight:700">
        商品总价：&yen; <span class="total_price">{tp#$total_price}</span> 元
        &ensp;&ensp;
        快递费用：&yen; <span class="express_price">{tp#$express_fee}</span> 元
        &ensp;&ensp;
        </p>     
        
    </div>
    
    <div class="well">
    	<p class="line" style="color:#DB383E;font-weight:700;text-align:right">
         订单总金额：&yen; <span class="total_fee">{tp#$total_fee}</span> 元
        </p>
    </div>
    
    <div class="well">
        <p class="line">
        <div class="btn-red fl" onclick='location.href="{tp#:U('Index/cart')}"';> 上一步</div>
        <div class="btn-next btn-red fr">立即下单</div>
        <div class="clear"></div>
        </p>
    </div>
    
    
    </div>
    
</div>
<div class="show_zhuan" onclick="$(this).hide();"></div>	
<script type="text/javascript">
	var addr_type=2;
	$(function(){
		
		$(".add-btn").click(function(){
			$(".label").removeClass('active');
			$(this).addClass('active');
			$(".add-addr").show();
			$(".sel-addr").hide();
			addr_type=1;			//新增
		});
		
		$(".sel-btn").click(function(){
			$(".label").removeClass('active');
			$(this).addClass('active');
			$(".sel-addr").show();
			$(".add-addr").hide();
			addr_type=2;			//选择
		});
		
		
		//计算快递费用
		$("#exp").change(function(){
			var exp_price=$("#exp option:selected").attr('price');	//邮费
			var total_price="{tp#$total_price}";					//商品总价
			var total_fee;											//订单总金额
			$(".express_price").text(exp_price);
			total_fee=parseFloat(exp_price)+parseFloat(total_price);
			$(".total_fee").text(total_fee);
		});
		
		$(".btn-next").click(function(){
			var post_data={};
			
			if(addr_type==1){
				post_data.consignee=$("input[name='consignee']").val();
				post_data.mobile=$("input[name='mobile']").val();
				post_data.province_id=$("#province").val();
				post_data.city_id=$("#city").val();
				post_data.district_id=$("#district").val();
				post_data.address=$("input[name='address']").val();
				
				var district_len=$("select[name='district'] option").length;
				
				
								
				if(post_data.consignee==''){
					//alert('请填写收货人！');
					$(".tip_box").text("请填写收货人").show();
					setTimeout("close_tip();",1000);
					return false;
				}
				if(post_data.mobile==''){
					//alert('请填写联系电话！');
					$(".tip_box").text("请填写联系电话").show();
					setTimeout("close_tip();",1000);
					return false;
				}
				if(post_data.province_id==''){
					//alert('请选择省份！');
					$(".tip_box").text("请选择省份").show();
					setTimeout("close_tip();",1000);
					return false;
				}
				if(post_data.city_id==''){
					//alert('请选择城市！');
					$(".tip_box").text("请选择城市").show();
					setTimeout("close_tip();",1000);
					return false;
				}
				if(post_data.district_id==''&&parseInt(district_len)>=2){
					//alert('请选择区县！');
					$(".tip_box").text("请选择区县").show();
					setTimeout("close_tip();",1000);
					return false;
				}
				if(post_data.address==''){
					//alert('请填写详细地址！');
					$(".tip_box").text("请填写详细地址").show();
					setTimeout("close_tip();",1000);
					return false;
				}
				
			}else if(addr_type==2){
				post_data.addr_id=$("select[name='addr_id']").val();
				if(post_data.addr_id==''){
					$(".tip_box").text("请选择收货地址").show();
					setTimeout("close_tip();",1000);
					return false;
				}
			}
			
			post_data.pay_way=$("#pay_way").val();					//支付方式
			//post_data.express_id=$("#exp").val();					//快递公司
			post_data.express_fee="{tp#$express_fee}";				//邮费总金额	
			//alert(addr_type);
			//return false;
			$.post("{tp#:U('Ajax/order')}",post_data,function(json){
				//alert(json.order_id);
				location.href="./wxpay/index.php?order_id="+json.order_id;
			},'json');
			
		});
	});

</script>

<!--QUYU-->
<div id="opquyu">
	
</div>
<div id="opquyubox">
	<!--商品分类导航-->
    <include file="Public:category"/>
   	<!--商品分类导航-->
</div>

<!--FOOTER-->
<!--底部-->
<include file="Public:footbar"/>
<!--底部-->

</body>

</html>
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta charset="utf-8">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="yes" name="apple-mobile-web-app-capable">
<meta content="black" name="apple-mobile-web-app-status-bar-style">
<meta name="format-detection" content="telephone=no">
<title>购物车 - {tp#$webinfo.web_title}</title>
<link type="text/css" rel="stylesheet" href="__PUBLIC__/css/comman.css" media="all">
<link type="text/css" rel="stylesheet" href="__PUBLIC__/css/jquery_dialog.css" media="all">
<link type="text/css" rel="stylesheet" href="__PUBLIC__/css/style.css" media="all">	
<script> var SITE_URL="http://www.wdkl168.com/";</script>
<script type="text/javascript" src="__PUBLIC__/js/jquery.min.js"></script> 
<script type="text/javascript" src="__PUBLIC__/js/jquery_dialog.js"></script> 
<script type="text/javascript" src="__PUBLIC__/js/common.js"></script> 
<script type="text/javascript" src="__PUBLIC__/js/jquery.json-1.3.js"></script> 
<script type="text/javascript" src="__PUBLIC__/js/goods.js"></script> 
<script type="text/javascript" src="__PUBLIC__/js/user.js"></script> 	
<script type="text/javascript" src="__PUBLIC__/js/jweixin-1.0.0.js"></script> 
</head>
<body>
<link type="text/css" rel="stylesheet" href="__PUBLIC__/css/css.css" media="all">
<div id="home">
	<div id="header">
		<div class="logo" style="height:28px; padding-top:10px; background:url(__PUBLIC__/images/xy.png) 10px 8px no-repeat"><span onclick=" history.go(-1);">&nbsp;</span></div>
		<div class="shoptitle"><span>购物车</span></div>
		<!--right-->
        <include file="Public:logoright"/>
        <!--right-->
	</div>
</div>	
<script type="text/javascript">
function ajax_show_menu(){
	$(".showmenu").toggle();
}
</script>

<style type="text/css">
.checkout{ background:#FFF; padding-top:10px; padding-bottom:10px}
.checkout p.title {
background: #eaeaea;
height: 27px;
line-height: 27px;
text-indent: 10px;
width: 100%;
color: #9a0000;
font-weight: bold;
margin: 10px 0px 0px 0px;
border-bottom:2px solid #CCC
}
.checkout table {
text-align: left;
color: #5f5f5f;
margin:0px;
}
.checkout td {
line-height: 18px;
padding: 3px 0px 3px 0px;
}
.checkout .userreddinfo td {
line-height: 18px;
padding: 2px 0px 2px 0px;
}
.checkout td label{ line-height:22px;}
label{ cursor:pointer}
.pw{ line-height:23px; height:23px;}
.addgallery i{font-style:normal;}
.item-box-buy-btn {
font-size: 12px;
color: #456f9a;
border: 1px solid #456f9a;
border-radius: 5px;
cursor: pointer;
float: right;
width: 80px;
height: 25px;
line-height: 25px;
text-align: center;
overflow: hidden;
white-space: nowrap;
background:#C7ECF3;
}
.addgallery{ padding-left:14px;background:url(__PUBLIC__/images/+.png) 3px center no-repeat}
.removegallery{ padding-left:14px;background:url(__PUBLIC__/images/-.png) 3px center no-repeat}
select{width:100%}
.jian{cursor:pointer; display:block; float:left; width:35px; height:22px;line-height:22px;text-align:center; font-size:18px; font-weight:bold; border:1px solid #ccc; background:#ededed}
.jia{cursor:pointer; display:block; float:left; width:35px; height:22px;line-height:22px;text-align:center; font-size:18px; font-weight:bold; border:1px solid #ccc; background:#ededed}
.goods_del{padding:2px 5px 2px 5px; color:#FF0000; cursor:pointer; position:absolute; right:5px; top:0px; z-index:22; background:#fafafa; border:1px solid #ededed;border-radius:5px;}
</style>
<div id="main" style="padding-top:0px; min-height:300px">
	<if condition="empty($list)">
	<div class="checkout">
        <div class="nodata" onclick='location.href="{tp#:U('Index/index')}"'>
            <p>购物车中暂时没有商品~</p>
        </div>
    </div>
	</if>    
	<div class="checkout" <if condition="empty($list)">style="display:none"</if>>
	<form action="#" method="post">
		
		<table border="0" cellpadding="0" cellspacing="0" style="width:100%;">
		 <tbody>
         <!--<tr>
		  <td>
		  <label style="padding-left:10px;"><input checked="checked" type="radio" class="showaddress" name="userress_id" value="6">
		  广东广州天河区eww<br><span style="padding-left:26px;"></span>电话:13609087236&nbsp;联系人:eeww</label>
		  <p style="padding-left:26px;">
		  <a href="javascript:;" onclick="ressinfoop(6,showupdate,this)" style="border-radius:5px;display:block;background:#3083CE;cursor:pointer;width:60px; height:22px; line-height:22px; font-size:12px; color:#FFF; text-align:center">修改</a>
		  </p>
		  </td>
		  </tr>
		  <tr>
		  <td><label style="padding-left:10px;"><input class="showaddress" name="userress_id" type="radio" value="0">&nbsp;添加新收货地址</label></td>
		  </tr>-->
		  <tr>
		  	<td align="left">
				<table width="100%" border="0" cellpadding="0" cellspacing="0" style="display:none" class="userreddinfo">
				  <tbody><tr>
					<td align="right">姓名：</td>
					<td align="left"><input type="text" value="" name="consignee" class="pw" style="width:95%;;"> 
					</td>
				  </tr>
				   <tr>
					<td align="right">区域：</td>
					<td align="left"></td>
					
				  </tr>
				  <tr class="address_sh">
					<td align="right">地址：</td>
					<td align="left"><input type="text" value="" name="address" class="pw" style="width:95%;;"></td>
				  </tr>
				  <tr>
					<td align="right">电话：</td>
					<td align="left"><input type="text" value="" name="mobile" class="pw" style="width:95%;"></td>
				  </tr>
				  <tr>
				  <td>&nbsp;</td>
				  <td align="left" colspan="2"><img src="__PUBLIC__/images/btu_add.gif" alt="" style="cursor:pointer" onclick="ressinfoop(0,add,CONSIGNEE_ADDRESS)"></td>
				  </tr>
			</tbody></table>
			</td>
		  </tr>
	    </tbody>
        </table>
		
        <table border="0" cellpadding="0" cellspacing="0" style="width:100%;margin-top:10px;border-top:1px solid #ededed;">
		 		
			<tbody>   
            
            <volist name="list" id="item"> 
            <tr class="cart-item">
				<td style="width:80px; text-align:center; height:80px; padding-top:10px; overflow:hidden; border-bottom:1px solid #ededed;" valign="top">
					<img onerror="this.src='__PUBLIC__/images/no-img.png'" src="{tp#$item.spic|get_thumb}" title="{tp#$item.goods_name}" border="0" style="width:78px; height:78px; border:1px solid #ededed; padding:1px; margin-left:5px;">
				</td>
				<td style="text-align:left;border-bottom:1px solid #ededed;" valign="top">
				<p style="padding-left:10px; padding-right:36px; position:relative; line-height:18px;">
					{tp#$item.name}
                    <br/>
                    <if condition="!empty($item['goods_norm'])">
                    规格：{tp#$item['norm']['title']}
                    </if>
                    <span cart_key="{tp#$key}" goods_id="{tp#$item.goods_id}" goods_norm="{tp#$item.goods_norm}"  class="delcartid goods_del" style="z-index:0">删除</span>
                    </p>
					<p style=" padding-left:10px;font-size:12px;line-height:20px;" class="raturnprice raturnprice323">
                    <!--专柜价:<font color="#5f5f5f">￥{tp#$item.market_price}</font>&nbsp;&nbsp;-->
                    单价:<font color="#FF0000" class="gprice323">￥{tp#$item.goods_price}</font>
                    </p>
				 <div class="item" style="height:20px; line-height:20px; position:relative; padding-left:10px; padding-top:7px">
						<a class="jian"  goods_id="{tp#$item.goods_id}" goods_norm="{tp#$item.goods_id}" cart_key="{tp#$key}">-</a>
                        <input readonly  name="goods_number" value="{tp#$item.goods_nums}" class="inputBg" style="float:left;text-align: center; width:20px; height:22px; line-height:22px;border-bottom:1px solid #ccc; border-top:1px solid #ccc" type="text"> 
                        <a class="jia" goods_id="{tp#$item.goods_id}" goods_norm="{tp#$item.goods_id}" cart_key="{tp#$key}">+</a>
                        <b style="margin-left:3px;"></b>
						&nbsp;&nbsp;小计:
                        <font color="#FF0000" class="gzprice323">
                        ￥{tp#$item.goods_price}*<span class="goods_nums">{tp#$item.goods_nums}</span>
                        </font>
				  </div>
				</td>
			</tr>
            </volist>
            

        </tbody>
        
        </table>
		<table  style="display:none" border="0" cellpadding="0" cellspacing="0" style="width:100%;border-bottom:1px solid #ededed; margin-top:10px;">
			<tbody>
            <tr>
				  <td align="right" width="20%"><span>支付方式：</span></td>
				  <td align="left" width="80%">
				  <table border="0" cellpadding="0" cellspacing="0" style="width:100%;">
                  <tbody>
                  <tr>
                  <td>
                  <select name="pay_way">
                  <option value="1">微信支付</option>
                  <option value="2">余额支付</option>
                  </select>
                  </td>
                  
				</tr>
                </tbody>
                </table>
                </td>
			</tr>
			<tr>
				  <td align="right" width="20%"><span>配送方式：</span></td>
				  <td align="left" width="80%">
					<table border="0" cellpadding="0" cellspacing="0" style="width:100%;">
                    <tbody>
                    <tr>
                    <td>
                    <select name="express" id="exp">
                    <volist name="express" id="item">
                    <option price="{tp#$item.price}" value="{tp#$item.id}">{tp#$item.name}</option>
                    </volist>
                    </select>
                    </td>
                  
					</tr>
                    </tbody>
                    </table>
                    </td>
			</tr>
			<tr>
				<td align="right" width="22%">订单附言：</td>
				<td>
				<textarea class="pw" name="postscript" id="postscript" style="width:96%; height:60px;"></textarea>
				</td>
			</tr>
		</tbody>
        </table>
		<div style="padding-left:5px;">
			<!--<p style="line-height:22px;">
				商品总价(不含运费)：
                <span style="color:red">
                ￥ <span class="total_price">{tp#$total_price}</span>元
                </span>
				&nbsp;&nbsp;
                配运费：
                <span style="color:red">
                ￥ <span class="express_price">{tp#$express[0]['price']}</span>
                </span>
			</p>
            
            <p  style="margin:10px 0;font-size:13px; font-weight:bold; ">
             订单总金额：
                <span style="color:red">
                ￥ <span class="total_fee">{tp#$total_fee}</span>
                </span>
            </p>-->
            
			
           <!-- <p style="line-height:22px; color:#222; font-size:14px; font-weight:bold; color:#9A0000; padding-top:5px;">
            产品金额:￥<span class="ztotals">{tp#$total_fee}</span>元
            </p>
            
			<p style="line-height:22px; color:#222; font-size:14px; font-weight:bold; color:#9A0000; padding-top:5px;">
            总金额:￥<span class="ztotals">{tp#$total_fee}</span>+￥<span class="freeshopp">0.00</span>(邮费)=<span class="freeshoppandprice">{tp#$total_fee}</span>元</p>-->
			
			<p style="height:30px; line-height:30px; margin-top:10px;">
			<!--<input value="确认提交" type="submit" align="absmiddle" onclick="return checkvar()" style="width:110px; height:30px; line-height:30px; background:#32a000; font-size:18px; color:#FFFFFF; font-weight:bold; text-align:center; cursor:pointer; float:left">
			&nbsp;&nbsp;
			 <input value="清空购物车" type="button" align="absmiddle" onclick="return ajax_clear()" style="width:120px; height:30px; line-height:30px; background:#ff6400; font-size:18px; color:#FFFFFF; font-weight:bold; text-align:center; cursor:pointer; float:left;margin-left:10px">-->
             
             
            <a class="btn-next" href="{tp#:U('Index/cart2')}">
            下一步
            </a>
             
			</p>
            
           
            
	  </div> 
	</form>
    
	</div>

</div>

<style>
.btn-next{padding:5px;width:120px; height:30px; line-height:30px; background:#DB383E; font-size:18px; color:#FFFFFF; font-weight:bold; text-align:center; cursor:pointer; float:right;margin-left:10px;color:#FFF !important}
</style>
 
<script language="javascript" type="text/javascript">
$(function(){
	$("#exp").change(function(){
		var exp_price=$("#exp option:selected").attr('price');	//邮费
		var total_price="{tp#$total_price}";					//商品总价
		var total_fee;											//订单总金额
		$(".express_price").text(exp_price);
		total_fee=parseFloat(exp_price)+parseFloat(total_price);
		$(".total_fee").text(total_fee);
	});
});

//2位小数
function toDecimal(x) {  
	var f = parseFloat(x);  
	if (isNaN(f)) {  
		return;  
	}  
	f = Math.round(x*100)/100;  
	return f;  
} 

function ajax_clear(){
	if(confirm('确定吗')){
		window.location.href='http://www.wdkl168.com/m/mycart.php?type=clear';
		return true;
	}
	return false;
}
$('.showaddress').live('click',function(){
	var vv= $(this).val();
	if(vv==0){
	$('.userreddinfo').show();
	}else{
	$('.userreddinfo').hide();
	}
	//$('.userreddinfo').toggle();
});

function checkvar(){
	pp = $('input[name="pay_id"]:checked').val(); 
	if(typeof(pp)=='undefined' || pp ==""){
		alert("请选择支付方式！");
		return false;
	}
	
	ss = $('input[name="shipping_id"]:checked').val(); 
	if(typeof(ss)=='undefined' || ss ==""){
		alert("请选择配送方式！");
		return false;
	}
	
	userress_id = $('input[name="userress_id"]:checked').val();
	if(userress_id == '0' || userress_id == '' || typeof(userress_id)=='undefined'){
			consignee = $('input[name="consignee"]').val(); 
			if(typeof(consignee)=='undefined' || consignee ==""){
				alert("收货人不能为空！");
				return false;
			}
			
			provinces = $('select[name="province"]').val();
			if ( provinces == '0' )
			{
				alert("请选择收货地址！");
				return false;
			}
			
			city = $('select[name="city"]').val();
			if ( city == '0' )
			{
				alert("请完整选择收货地址！");
				return false;
			}
			
			district = $('select[name="district"]').val();
			if ( district == '0' )
			{
				alert("请完整选择收货地址！");
				return false;
			}
		
			address = $('input[name="address"]').val(); 
			if(typeof(address)=='undefined' || address ==""){
				alert("详细地址不能为空！");
				return false;
			}
			
			mobile = $('input[name="mobile"]').val(); 
			tel = $('input[name="tel"]').val(); 
			if(mobile =="" && tel ==""){
				alert("请输入手机或者电话号码！");
				return false;
			}
	}	

	return true;
}

//删除购物车
$('.delcartid').click(function(){
	if(confirm("确定移除吗")){
		var obj = $(this);
		var cart_count = $('.mycarts').html();			//购物车中商品总数
		
		var post_data={}; 
		post_data.goods_id=$(this).attr('goods_id');
		post_data.goods_norm=$(this).attr('goods_norm');
		post_data.goods_norm=$(this).attr('goods_norm');
		post_data.cart_key=$(this).attr('cart_key');
		
		$.post("{tp#:U('Ajax/delcart')}",post_data,function(data){
			if(data==1){
				obj.parent().parent().parent().remove();
				number = $(obj).parent().parent().find('input[name="goods_number"]').val();
				$('.mycarts').html(parseInt(cart_count)-parseInt(number));
			}																					
		});
		
	}
	return false;
});

//计算邮费
function jisuan_shopping(id){
		if(id=="" || typeof(id)=='undefined') return false;
		uu = $('input[name="userress_id"]:checked').val();
		if(typeof(uu)=='undefined' || uu ==""){
			alert("请选择一个收货地址！");
			return false;
		}
		createwindow();
		$.post('http://www.wdkl168.com/m/mycart.php',{action:'jisuan_shopping',shopping_id:id,userress_id:uu},function(data){
				if(data !="" && typeof(data) !='undefined'){
					arr = data.split('+');
					if(arr.length==2){
					$('.freeshopp').html(arr[1]);
					b = $('.ppzprice').html();
					if(b==null || typeof(b)=='undefined'){
						b = $('.ztotals').html();
					}
					
					$('.freeshoppandprice').html(toDecimal(parseFloat(b)+parseFloat(arr[1])));
					}else{
						alert(data);
					}
				}else{
					$('.freeshopp').html('0.00');
					b = $('.ppzprice').html();
					if(b==null || typeof(b)=='undefined'){
						b = $('.ztotals').html();
					}
					$('.freeshoppandprice').html(parseFloat(b));
				}
				removewindow();
		});
		
}

//数量减1
$('.jian').live('click',function(){
	ob = $(this).parent();
	numobj = ob.find('input[name="goods_number"]');
	vall = $(numobj).val();
	if(!(vall>0)){
		ob.val('1');
		return false;
	}
	if(vall>1){
		$(numobj).val((parseInt(vall)-1));
	}
	nn = $('.mycarts').html();
	$('.mycarts').html(parseInt(nn)-1);
	//change_number(numobj);
	
	
	//修改该商品购买数量
	var goods_nums=parseInt($(this).siblings('font').children('span.goods_nums').text())-1;
	if(goods_nums<=0){
		$(this).parent('div').parent('td').parent('tr').remove();
	}else{
		$(this).siblings('font').children('span.goods_nums').text(goods_nums);
	}
	
	var post_data={};
	post_data.act='sub';
	post_data.cart_key=$(this).attr('cart_key');
	post_data.goods_id=$(this).attr('goods_id');
	post_data.goods_norm=$(this).attr('goods_norm');
	$.post("{tp#:U('Ajax/updatecart')}",post_data,function(data){
		if(data==1){
			//location.reload();
		}																						
	});
	
});
//数量加1
$('.jia').live('click',function(){
	ob = $(this).parent();
	numobj = ob.find('input[name="goods_number"]');
	vall = $(numobj).val();
	if(!(vall>0)){
		$(ob).val('1');
		return false;
	}
	$(numobj).val((parseInt(vall)+1));
	nn = $('.mycarts').html();
	$('.mycarts').html(parseInt(nn)+1);
	//change_number(numobj);
	
	//修改该商品购买数量
	var goods_nums=parseInt($(this).siblings('font').children('span.goods_nums').text())+1;
	$(this).siblings('font').children('span.goods_nums').text(goods_nums);
	var post_data={};
	post_data.act='add';
	post_data.cart_key=$(this).attr('cart_key');
	post_data.goods_id=$(this).attr('goods_id');
	post_data.goods_norm=$(this).attr('goods_norm');
	//console.log(post_data);return;
	$.post("{tp#:U('Ajax/updatecart')}",post_data,function(data){
		if(data==1){
			//location.reload();
		}																						
	});
});


//改变商品价格
function change_number(obj){
	//地址ID
	userressid = $('input[name="userress_id"]:checked').val();
	if(userressid>0){}else{
		userressid = 5;
	}
	//配送ID
	shippingid = $('input[name="shipping_id"]:checked').val();
	
	id = $(obj).attr('id');
	numbers = $(obj).val();
	if(!(numbers>0)){
	 	numbers = 1;
	 	$(obj).val('1');
	}
	//createwindow();
	/*$.post(SITE_URL+'mycart.php',{action:'ajax_change_price',id:id,number:numbers,shipping_id:shippingid,userress_id:userressid},function(data){ 
		removewindow();
		if(data.error=='0'){
			dis = 1;
			data.prices = toDecimal(data.prices * dis);
			$('.ztotals').html(data.prices);
			$('.gprice'+id).html('￥'+data.thisprice);
			$('.gzprice'+id).html('￥'+toDecimal(data.thisprice * numbers));
			ff = data.freemoney;
			$('.freeshopp').html(ff);
			$('.freeshoppandprice').html(toDecimal(toDecimal(data.prices)+toDecimal(ff)));
		}else{
			alert(data.message);
		}
	}, "json");*/
	return true;
}

</script>
<!--QUYU-->
<div id="opquyu">
	
</div>
<div id="opquyubox">
	<!--商品分类导航-->
    <include file="Public:category"/>
   	<!--商品分类导航-->
</div>

<!--FOOTER-->
<!--底部-->
<include file="Public:footbar"/>
<!--底部-->

</body>

</html>
<html><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Cache-Control" content="no-store">
<meta content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=0, minimal-ui" name="viewport">

<title>在线咨询-{tp#$webinfo.web_title}</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="keywords" content="{tp#$webinfo.web_keywords}">
<meta name="description" content="{tp#$webinfo.web_description}">



<link rel="stylesheet" media="screen" href="__PUBLIC__/css/ydl_v2.css">

<link rel="stylesheet" href="__PUBLIC__/css/weui.min.css">

<link rel="stylesheet" media="screen" href="__PUBLIC__/css/nprogress.css">
<script src="__PUBLIC__/js/nprogress.js" data-turbolinks-eval="false"></script>
<script src="__PUBLIC__/js/jquery-2.1.0.min.js" data-turbolinks-eval="false"></script>
<script src="__PUBLIC__/js/jquery-extend.js"></script>
<script src="__PUBLIC__/js/weui.js"></script>



</head>
<body ontouchstart="">

<!--mNav-->
<div class="header sNav">

   <div class="iconBack"></div>
   <div class="iconBack-title">预约咨询</div>

  

    <div class="menu2"></div>
    <div class="userCenter"></div>

</div>
<!--mMenu-->
<div class="navbar sNav">
<include file="Public:navbar"/>
</div>







<style>
    .zaixian{display: none;}
</style>
<div class="header">
  <div class="iconBack"></div>
  <div class="iconBack-title">咨询</div>
  <div class="menu2"></div>
  <div class="userCenter"></div>
</div>
<form novalidate id="new_order" action="/booking" accept-charset="UTF-8" method="post">
<div class="container js_container"><div class="page slideIn cell">
    <div class="sNav button_group_1 fixed_bottom">
      <a class="mButton btn-sub" href="javascript:void(0);">立即下单</a>
    </div>
    <div class="bd">
      <div class="weui_cells_title mB10 txt-c"><font class="fc-orange">1、下单</font>－2、付款－3、咨询</div>
      <div class="weui_panel weui_panel_access">

        <div class="weui_panel_bd">
          <div class="weui_media_box weui_media_appmsg weui_media_text ">
            <div class="weui_media_hd">
              <img class="weui_media_appmsg_thumb" src="{tp#$expert.headimgurl}" alt="{tp#$expert.nickname}" style="border-radius: 50%;">
            </div>
            <div class="weui_media_bd">
              <h4 class="weui_media_title">{tp#$expert.nickname}</h4>
                                <p class="weui_media_desc yuyue">911人已咨询过</p>
                <p class="weui_media_desc zaixian" style="display: none;">911人已咨询过</p>
            </div>
          </div>

        </div>
      </div>
      <div class="order_select_box">
        <ul>
                <li class="order_selected" data-type-id="2" data-price="50">在线咨询</li>
                <!--<li data-type-id="3" data-price="125">当面咨询</li>
                <li data-type-id="1" data-price="6">在线咨询</li>-->
        </ul>
      </div><div class="clear"></div>
      <div class="weui_cells">
        <div class="weui_cell">
          <div class="weui_cell_hd"><label class="weui_label">收费</label></div>
          <div class="weui_cell_bd weui_cell_primary">
            <div class="weui_input" id="price_desc">50元/15分钟</div>
          </div>
        </div>
      </div>
      <div class="weui_cells_title yuyue">60分钟沟通效果最好<font class="fc-red" style="font-weight: bold;">点击下方更改时间↓</font></div>
      <div class="weui_toptips weui_warn js_tooltips">格式不对</div>
      <!--预约咨询显示-->
      <div class="weui_cells yuyue">
        <div class="weui_cell weui_cell_select weui_select_after">
          <div class="weui_cell_hd">
            购买
          </div>
          <div class="weui_cell_bd weui_cell_primary">
            <select class="weui_select" name="order[time_buckets]" id="time_buckets">
                <option value="2">30分钟</option>
                <option value="3">45分钟</option>
                <option value="4">60分钟</option>
            </select>
          </div>
        </div>
        <div class="weui_cell">
          <div class="weui_cell_hd"><label class="weui_label">总计</label></div>
          <div class="weui_cell_bd weui_cell_primary">
            <div class="weui_input"><font class="fc-orange" id="price_total">100元</font>
            </div>
          </div>
        </div>
      </div>

        
      <!--在线咨询显示-->
      <article class="weui_article zaixian" style="padding-bottom: 0px; display: none;">
          <section>
                  <p>1次付款，24小小时内沟通有效<br>专家利用空闲时间
                  为您解答，诊断问题，不能替代正式咨询。</p>
          </section>
      </article>

      <div class="weui_cells weui_cells_access">
        <div class="weui_cell weui_cell_warn">
          <div class="weui_cell_hd">
            <label for="" class="weui_label">姓名</label></div>
          <div class="weui_cell_bd weui_cell_primary">
            <input class="weui_input" type="text" name="order[name]" value="{tp#$user_info.name}" placeholder="请输入">
          </div>
        </div>

        <div class="weui_cell weui_cell_warn">
            <div class="weui_cell_hd">
                <label for="" class="weui_label">年龄</label></div>
            <div class="weui_cell_bd weui_cell_primary">
                <input class="weui_input" type="number" name="order[age]" value="{tp#$user_info.age}" placeholder="请输入">
            </div>
        </div>

        <div class="weui_cell weui_cell_select weui_select_after">
            <div class="weui_cell_hd">
            性别
          </div>
          <div class="weui_cell_bd weui_cell_primary">
            <select class="weui_select" name="order[sex]">
              <option value="1" <eq name="user_info['sex']" value="2">selected</eq> >男</option>
              <option value="2" <eq name="user_info['sex']" value="2">selected</eq> >女</option>
            </select>
          </div>
        </div>
        <!--预约咨询显示-->
        <div class="weui_cell weui_cell_warn yuyue">
          <div class="weui_cell_hd">
            <label for="" class="weui_label">手机</label></div>
          <div class="weui_cell_bd weui_cell_primary">
            <input class="weui_input" type="number" name="order[mobile]" value="{tp#$user_indfo.mobile}" placeholder="请输入">
          </div>
        </div>
      </div>
      <!--在线咨询显示-->
      <div class="weui_cells zaixian" style="display: none;">
          <div class="weui_cell weui_cell_select weui_select_after">
              <div class="weui_cell_hd">
                  话题
              </div>
              <div class="weui_cell_bd weui_cell_primary">
                  <select class="weui_select" name="order[tag_id]">
                        <option value="1" selected="">恋爱婚姻</option>
                        <option value="2">情绪压力</option>
                        <option value="3">人际关系</option>
                        <option value="4">家庭关系</option>
                        <option value="5">孩子教育</option>
                        <option value="6">职业发展</option>
                        <option value="7">个人成长</option>
                        <option value="8">性心理</option>
                    </select>
              </div>
          </div>
      </div>
      <div class="weui_cells weui_cells_form">
        <div class="weui_cell">
          <div class="weui_cell_bd weui_cell_primary">
            <textarea class="weui_textarea" placeholder="一句话简单描述您的问题" rows="3" id="order_question" name="order[remark_user]"></textarea>
            <div class="weui_textarea_counter"></div>
          </div>
        </div>
      </div>
    </div>
  </div></div><div style="height: 100px;"></div>
</form>

<script src="__PUBLIC__/js/zepto.min.js"></script>
<script>
$(function(){
   $('.zaixian').hide();$('.yuyue').show();
   var price_total;
    //咨询类型变化
    $('.order_select_box ul li').click(function(){
        var serviceType=$(this).attr('data-type-id');
        var price=parseInt($(this).attr('data-price'));
        var time_buckets=$('#time_buckets option:selected').val();
        price_total=price*parseInt(time_buckets);

        //样式变化
        $('.order_select_box ul li').removeClass('order_selected');
        $(this).addClass('order_selected');

        //根据咨询类型不同，显示不同表单内容
        if(serviceType==1){
            var price_desc=price+'元/1次';
            $('.zaixian').show();
            $('.yuyue').hide();
            $('#new_order').attr('action', '/consult/create?cf=1');
        }else{
            var price_desc=price+'元/15分钟';
            $('.zaixian').hide();
            $('.yuyue').show();
            $('#new_order').attr('action', '/booking');
        }

        //价格增加
        $('#price_total').html(price_total+'元');
        $('#price_desc').html(price_desc);

        //设置类型
        $('#order_type').val(serviceType);

    });

    //时段变化
    $('#time_buckets').change(function(){
        var price=parseInt($('.order_selected').attr('data-price'));
        var price_desc=price+'元/15分钟';
        var time_buckets=$('#time_buckets option:selected').val();
        var price_total=price*parseInt(time_buckets);

        //价格增加
        $('#price_total').html(price_total+'元');
        $('#price_desc').html(price_desc);
    });

    var error={
        'order[type]':'请选择咨询类型',
        'order[name]':'请输入您的姓名',
        'order[gender]':'请选择性别',
        'order[age]':'请输入您的年龄',
        'order[city]':'请填写您所在的城市',
        'order[relationship]':'请选择您的婚姻信息',
        'order[mobile]':'请输入11位手机号',
        'order[remark_user]':'请填写描述内容',
        'accept':'请阅读并同意咨询服务协议'
    };

    $('.btn-sub').click(function(){
        var $name = $('input[name="order[name]"]').val(),
            $mobile = $('input[name="order[mobile]"]').val(),
            $age = $('input[name="order[age]"]').val(),
			$sex = $('select[name="order[sex]"]').val(),
			$duration=$('#time_buckets').val();			//咨询时长
            $question = $('#order_question').val();
            //serviceType=$('.order_selected').attr('data-type-id');
		
		if (!$name) {
            $.tooltips(error['order[name]']);
            return false;
        }

        if (!$age) {
            $.tooltips(error['order[age]']);
            return false;
        }
		
		if (!$mobile) {
            $.tooltips(error['order[mobile]']);
            return false;
        }
		
		if (!$question) {
            $.tooltips('请填写问题描述');
            return false;
        }
		
		var post_data={};
		post_data.expert_id="{tp#$Think.get.id}";	//专家id
		post_data.name=$name;
		post_data.mobile=$mobile;
		post_data.age=$age;
		post_data.sex=$sex;
		post_data.remark=$question;				//问题描述
		post_data.type=1;						//订单类型
		switch($duration){
			case '2':
				post_data.duration=30;
				post_data.total_fee=100;
			break;
			case '3':
				post_data.duration=45;
				post_data.total_fee=150;
			break;
			case '4':
				post_data.duration=60;
				post_data.total_fee=200;
			break;
		}
       
		
		//console.log(post_data);return ;
		$.post("{tp#:U('Ajax/chat_order_submit')}",post_data,function(data){
			//alert(data);
			location.href="/wxpay/index.php?order_id="+data;
		});
		
        if( serviceType!=1 ){
            $('#new_order').attr('action', '/booking');
            //设置类型
            $('#order_type').val(serviceType);
            if (!$phone.val() || $phone.val().length != 11) {
                $.tooltips(error['order[phone]']);
                return false;
            }
        }

        if( serviceType==1 ){
            $('#new_order').attr('action', '/consult/create?cf=1');
            //设置类型
            $('#order_type').val(serviceType);
            if (!$question.val() || $question.val().length < 1) {
                $.tooltips(error['order[remark_user]']);
                return false;
            }
        }

        return true;
    });
	
	
});


function toSubmit(){
    $('#new_order').trigger('submit');
}
</script>

<!-- <div class="sNav" style="margin-bottom:60px"></div> -->
<!--side-->

<div id="menu_mask">
</div>

<div class="dropdown-modal"></div>
<div id="modal"></div>
<script src="__PUBLIC__/js/juicer-min.js"></script>

<script src="__PUBLIC__/js/web_new.js"></script>

<!--side-->
<script>

function BindPhone(){
  this.index=0;
  this.err=false;
  this.phone='';
  this.isListen=1;
  this.trigger='#bind-phone';
  this.box='#bind_phone_box';
  this.next_btn='#bpnext';
  this.send_btn='#bpsend';
  this.succ_btn='#bpsucc';
  this.chphone_btn='#bpchphone';
  this.cc_sign='38f2e199f892143d5bfda6f09de2dbfe';
  this.link_btn='#bplink';
  this.tm=false;
  this.close_btn="#bpclose";
  this.succ_cb=null;
  this.heights={
    'phone':250,
    'checkandpass':350,
    'check':270,
    'bindsucc':280
  };
  this.types=['phone','checkandpass','check','bindsucc'];
  var that=this;
  $(this.trigger).click(function(){
    
    that.sb();

  });
  $(document).off('click',this.next_btn).on('click',this.next_btn,function(){
    var items=$(that.box).find('.input_item');
    for(i=0;i<items.length;i++){

      var type=$(items[i]).attr("data-propertyname");
      if(type=='phone'){
        var rs=that.checkPhone($(items[i]));
      }

      if(type=='verifyCode'){

        var rs=that.checkCode($(items[i]));
      }

    }
  });

  $(document).off('click',this.chphone_btn).on('click',this.chphone_btn,function(){

    that.index=0;

    that.sb(false);
  });


  $(document).off('click',this.send_btn).on('click',this.send_btn,function(){
    var sended=$(that.send_btn).attr("data-sended");
    if(sended==1)
      return false;
    $(that.send_btn).addClass('btn_disabled').removeClass('.btn_active');
    that.sendCode(function(){

      that.leftTime(60);
    });
  });

  $(document).off('click',this.close_btn).on('click',this.close_btn,function(){

    var $modal = $.modalInit('#modal');
    $modal.hide();
    $(that.box).remove();
    if(that.index==3)
      window.location.reload();
  });

  $(document).off('click',this.link_btn).on("click",this.link_btn,function(){
    var type=$(this).attr('data-type');
    if(type=='use'){
      window.location.href='/app';
      
    }
    else{
      window.location.href='/uc/rechargeP';
    }

  });
  $(document).off('click',this.succ_btn).on('click',this.succ_btn,function(){

    var $modal = $.modalInit('#modal');
    $modal.hide();
    $(that.box).remove();
    (that.succ_cb)();

  });

}



BindPhone.prototype={
  cls:function(){
    clearTimeout(this.tm);
    $(this.box).remove();
  },

  sb:function(cb){

    this.cls();
    var argNum=arguments.length;
    if(argNum==4){
      this.phone=arguments[1];
      this.isListen=parseInt(arguments[2]);
      this.succ_cb=arguments[3];
    }
    var $modal = $.modalInit('#modal');
    $modal.show();
    var curtype=this.types[this.index];
    var height=parseInt(this.heights[curtype]);
    var tpl=$('#bind_phone_tpl').html();
    var html=juicer(tpl,{type:curtype,height:height,phone:this.phone,isListen:this.isListen});
    $('body').append(html);
    if(this.index==1 || this.index==2){
      $(this.send_btn).attr('data-sended','1');
    }
    
    if(argNum>0 && arguments[0]){
      arguments[0]();
    }
    
  },

  checkPhone:function(obj){
    var phone=obj.find('input[type=text]').val();
    if(!/^\d{11}$/.test(phone)){
      this.showMsg(obj,'请输入正确的手机号码');
      return false;
    }
    var that=this;
    $.post('/accountset/hasBindPhoneCs',{phone:phone},function(rs){
      
      rs=eval("("+rs+")");
      if(rs.code==-1){
        that.showMsg(obj,'请输入正确的手机号码');
        return false;
      }

      if(rs.code==-2){
        that.showMsg(obj,rs.msg);
        return false;
      }
      var skip=2;
      if(rs.code=='-3'){
        skip=1;
        
      }
      that.phone=phone;
      that.index+=skip;
      that.sendCode();
      that.sb(function(){

        that.leftTime(60);

      });

      
    });

  },

  checkCode:function(obj){
    var code=obj.find('input[type=text]').val();
    if(code.length!=4){

      this.showMsg(obj,'验证码有误，请重新输入');
      return false;
    }
    var passwd='';
    if(this.index==1){

      var passwdObj=$(this.box).find(".input_item[data-propertyname=passwd]");
      passwd=passwdObj.find('input[type=password]').val();
      if(!passwd || passwd.length<6 ||passwd.length>16){
        this.showMsg(passwdObj,'密码长度6-16位 英文或数字组合');
        return false;
      }

    }
    var that=this;
    $.post("/accountset/bindNextEnsure",{username:this.phone,passwd:passwd,vcode:code},function(rs){
      rs=eval("("+rs+")");
      if(rs.errNo==0){
        that.index=3;
        that.sb();
      }
      else{
        that.showMsg(obj,rs.msg);
      }

    });

  },
  showMsg:function(obj,msg){
    $(obj).find('.input_tips').remove();
    $(obj).append('<span data-valid-message="" class="input_tips">'+msg+'</span>');
    $(obj).find('input[type=text],input[type=password]').addClass('input_warning');

  },
  sendCode:function(cb){
    $.post('/user/SendChkCode',{username: this.phone, sms_action: 'bind_phone',funk_you:this.cc_sign},function(rs){

      rs=eval("("+rs+")");
      if(rs.errNo==0){
        X.dialog.tips('短信已发送至您的手机');
      }
      if(cb){
        cb();
      }
    });
  },
  leftTime:function(count){
    var that =this;
    count--;
    leftTim=count;
    var v = "重发("+leftTim+")";
    $(this.send_btn).val(v);
    if(leftTim < 0){
      $(that.send_btn).val("重新发送").removeClass('btn_disabled').addClass('btn_active').attr('data-sended','0');
      clearTimeout(that.timeout);
    }
    else{
      that.tm=setTimeout(function(){
        that.leftTime(count);
      },1000);
    }
  }


}


</script>


<script>
var bindPhone=new BindPhone();
$(document).ready(function(){
  //mobile menu
  var flag=false;
  $('.menu2').on('click', function(){
    if(flag){
      $('.navbar.sNav').stop(true,true).animate({top: '-440px'}, 100);
      $('#menu_mask').removeClass('active');
      flag=false;
    }else{
      $('.navbar.sNav').stop(true,true).animate({top: '30px'}, 100);
      $('#menu_mask').addClass('active');
      flag=true;
    }
  });

  $('#menu_mask').on('touchend', function(){
    $('.navbar.sNav').stop(true,true).animate({top: '-440px'}, 100);
    $('#menu_mask').removeClass('active');
    flag=false;
  });

  
  $('.iconBack').on('click', function () {
    window.location.href="/";
  });
  $('.userCenter').on('click', function () {
    window.location.href="{tp#:U('Ucenter/index')}";
  });
});
</script>



<!-- fixed-bar end -->

<!--footer-->
<include file="Public:footer"/>
<!--footer-->

</body>

</html>